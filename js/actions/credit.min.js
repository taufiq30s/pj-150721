class Credit extends Monogatari.Action{static matchObject(e){return void 0!==e.Credit}constructor(e){super(),this.statement=e.Credit,this.fade_interval=3e3,this.scroll_speed=1500,this.quote_interval=7e3}apply(){return this.engine.settings().isFinished=!0,this.engine.global("block",!0),this.engine.element().find('[data-component="text-box"]').hide(),this.container=document.createElement("credits-container"),this.wrapper=document.createElement("div"),this.container.className="animated fadeIn",this.wrapper.className="wrapper",this.container.append(this.wrapper),this.engine.element().append(this.container),new Promise(e=>{this.runCredit().then(()=>{this.engine.global("block",!1),this.container.classList.remove("fadeIn"),this.container.classList.add("fadeOut"),this.container.addEventListener("animationend",()=>{this.container.remove(),e({advance:!0})})})})}didApply(){return Promise.resolve({advance:!0})}runCredit(){return"fade"in this.statement&&"scroll"in this.statement&&"quote"in this.statement?new Promise(e=>{this.fadeStart(this.statement.fade).then(()=>{this.scrollStart(this.statement.scroll).then(()=>{this.fadeQuoteStart(this.statement.quote).then(()=>{e()})})})}):"fade"in this.statement?this.fadeStart(this.statement.fade):"scroll"in this.statement?this.scrollStart(this.statement.scroll):"quote"in this.statement?this.fadeQuoteStart(this.statement.fade):Promise.resolve()}fadeQuoteStart(e){return this.container.classList.remove("credit-scroll"),this.container.classList.add("credit-fade"),new Promise(t=>{this.fadeQuote(e.content,e.source,t)})}fadeQuote(e,t,n){this.fadeQuoteContent(e,t).then(()=>{n()})}fadeQuoteContent(e,t){this.wrapper.innerHTML="",this.wrapper.style.removeProperty("transition"),this.wrapper.style.removeProperty("transform");let n=this.createElementQuote(e,t);return n.classList.add("animated","fadeIn"),this.wrapper.append(n),new Promise(e=>{setTimeout(()=>{n.classList.remove("fadeIn"),n.classList.add("fadeOut"),n.addEventListener("animationend",()=>{n.remove(),e()})},this.quote_interval)})}fadeStart(e){return this.container.classList.remove("credit-scroll"),this.container.classList.add("credit-fade"),new Promise(t=>{this.fade(e,0,t)})}fade(e,t,n){if(!(t in e))return void n();const s=e[t];"content"in s?this.fadeContent(s.title,s.content).then(()=>{this.fade(e,t+1,n)}):"list"in s?this.fadeList(s.title,s.list).then(()=>{this.fade(e,t+1,n)}):"quote"in this.statement&&this.fadeContent(s.content,s.source).then(()=>{this.fade(e,t+1,n)})}fadeContent(e,t){let n=this.createElementContent(e,t);return n.classList.add("animated","fadeIn"),this.wrapper.append(n),new Promise(e=>{setTimeout(()=>{n.classList.remove("fadeIn"),n.classList.add("fadeOut"),n.addEventListener("animationend",()=>{n.remove(),e()})},this.fade_interval)})}fadeList(e,t){let n=this.createElementList(e,t);return n.classList.add("animated","fadeIn"),this.wrapper.append(n),new Promise(e=>{setTimeout(()=>{n.classList.remove("fadeIn"),n.classList.add("fadeOut"),n.addEventListener("animationend",()=>{n.remove(),e()})},this.fade_interval)})}scrollStart(e){return this.container.classList.remove("credit-fade"),this.container.classList.add("credit-scroll"),new Promise(t=>{this.scroll(e,t)})}scroll(e,t){for(const t in e){const n=e[t];if("content"in n){let e=this.createElementContent(n.title,n.content);this.wrapper.append(e)}else if("list"in n){let e=this.createElementList(n.title,n.list);this.wrapper.append(e)}}let n=Math.round(this.wrapper.clientHeight/100*this.scroll_speed),s=Math.round(this.wrapper.clientHeight+window.innerHeight);this.wrapper.style.setProperty("transition","transform "+n+"ms linear"),this.wrapper.style.setProperty("transform","translateY(-"+s+"px)"),this.wrapper.addEventListener("transitionend",()=>{t()})}createElementContent(e,t){let n=Array.isArray(t)?t:[t],s=document.createElement("div");s.className="credit-section";let i=document.createElement("h1"),a=document.createElement("div");i.textContent=e;for(const e in n){let t=document.createElement("p");t.textContent=n[e],a.append(t)}return s.append(i),s.append(a),s}createElementQuote(e,t){let n=document.createElement("div");n.className="credit-section";let s=document.createElement("p"),i=document.createElement("p");return s.textContent=e,i.textContent=t,i.id="source",n.append(s),n.append(i),n}createElementList(e,t){let n=Array.isArray(t),s=document.createElement("div"),i=document.createElement("h1"),a=document.createElement("dl");s.className="credit-section",i.textContent=e;for(const e in t){if(!n){let t=document.createElement("dt");t.textContent=e,a.append(t)}let s=document.createElement("dd");if(Array.isArray(t[e]))for(const n in t[e]){let i=document.createElement("p");i.textContent=t[e][n],s.append(i)}else s.textContent=t[e];a.append(s)}return s.append(i),s.append(a),s}revert(){return Promise.resolve()}}