class ExtendBackground extends Monogatari.Action{static setup(){return monogatari.history("background"),monogatari.state({background:""}),monogatari.global("_scene_history_cleared_by_background",!1),Promise.resolve()}static onLoad(){const{background:t,scene:e}=monogatari.state();if("string"==typeof t&&""!==t&&""===e){const e=monogatari.prepareAction(t,{cycle:"Application"});return e.willApply().then(()=>e.apply().then(()=>e.didApply({updateHistory:!1,updateState:!1})))}return Promise.resolve()}static reset(){const t=$_('[data-ui="extend-background"]');return t.style("background-image","initial"),t.style("background-color","initial"),monogatari.state({extBackground:""}),Promise.resolve()}static matchString([t,e]){return"show"===t&&"ext-background"===e}constructor([t,e,a,...s]){if(super(),this.extBackground=a,this.property="background-image",void 0!==monogatari.asset("scenes",a))this.value=`url(${monogatari.setting("AssetsPath").root}/${monogatari.setting("AssetsPath").scenes}/${monogatari.asset("scenes",a)})`;else{const t=[a,...s].join(" ");s.indexOf("with")>-1?this.value=Text.prefix("with",t):this.value=t;const e=["#","rgb","hsl"].findIndex(t=>0===this.value.indexOf(t))>-1,o=!(this.value.indexOf(" ")>-1)&&(new RegExp(/\w+/).test(this.value)&&!new RegExp(/(url|gradient)\(/).test(this.value));!0!==e&&!0!==o||(this.property="background-color")}void 0!==s?this.classes=["animated",...s]:"remove"!==s?this.reset():this.classes=[]}willApply(){const t=$_('[data-ui="extend-background"]');return t.removeClass(),t.get(0).offsetWidth,Promise.resolve()}apply(){const t=$_('[data-ui="extend-background"]');$_('[data-ui="extend-background"]').style("background-image","initial"),$_('[data-ui="extend-background"]').style("background-color","initial"),$_('[data-ui="extend-background"]').style("animation-duration",""),$_('[data-ui="extend-background"]').style(this.property,this.value);const e=this.classes.indexOf("duration");e>-1&&t.style("animation-duration",this.classes[e+1]);for(const e of this.classes)t.addClass(e);return Promise.resolve()}didApply({updateHistory:t=!0,updateState:e=!0}={}){return!0===e&&monogatari.state({background:this._statement}),!0===t&&monogatari.history("background").push(this._statement),Promise.resolve({advance:!0})}}ExtendBackground.id="ExtendBackground",monogatari.registerAction(ExtendBackground);