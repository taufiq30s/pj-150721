class Credit extends Monogatari.Action{static matchObject(e){return void 0!==e.Credit}constructor(e){super(),this.statement=e.Credit,this.fade_interval=3e3,this.scroll_speed=1500}apply(){return this.engine.global("block",!0),this.engine.element().find('[data-component="text-box"]').hide(),this.container=document.createElement("credits-container"),this.wrapper=document.createElement("div"),this.container.className="animated fadeIn",this.wrapper.className="wrapper",this.container.append(this.wrapper),this.engine.element().append(this.container),new Promise(e=>{this.runCredit().then(()=>{this.engine.global("block",!1),this.container.classList.remove("fadeIn"),this.container.classList.add("fadeOut"),this.container.addEventListener("animationend",()=>{this.container.remove(),e({advance:!0})})})})}didApply(){return Promise.resolve({advance:!0})}runCredit(){return"fade"in this.statement&&"scroll"in this.statement?new Promise(e=>{this.fadeStart(this.statement.fade).then(()=>{this.scrollStart(this.statement.scroll).then(()=>{e()})})}):"fade"in this.statement?this.fadeStart(this.statement.fade):"scroll"in this.statement?this.scrollStart(this.statement.scroll):Promise.resolve()}fadeStart(e){return this.container.classList.remove("credit-scroll"),this.container.classList.add("credit-fade"),new Promise(t=>{this.fade(e,0,t)})}fade(e,t,n){if(!(t in e))return void n();const i=e[t];"content"in i?this.fadeContent(i.title,i.content).then(()=>{this.fade(e,t+1,n)}):"list"in i&&this.fadeList(i.title,i.list).then(()=>{this.fade(e,t+1,n)})}fadeContent(e,t){let n=this.createElementContent(e,t);return n.classList.add("animated","fadeIn"),this.wrapper.append(n),new Promise(e=>{setTimeout(()=>{n.classList.remove("fadeIn"),n.classList.add("fadeOut"),n.addEventListener("animationend",()=>{n.remove(),e()})},this.fade_interval)})}fadeList(e,t){let n=this.createElementList(e,t);return n.classList.add("animated","fadeIn"),this.wrapper.append(n),new Promise(e=>{setTimeout(()=>{n.classList.remove("fadeIn"),n.classList.add("fadeOut"),n.addEventListener("animationend",()=>{n.remove(),e()})},this.fade_interval)})}scrollStart(e){return this.container.classList.remove("credit-fade"),this.container.classList.add("credit-scroll"),new Promise(t=>{this.scroll(e,t)})}scroll(e,t){for(const t in e){const n=e[t];if("content"in n){let e=this.createElementContent(n.title,n.content);this.wrapper.append(e)}else if("list"in n){let e=this.createElementList(n.title,n.list);this.wrapper.append(e)}}let n=Math.round(this.wrapper.clientHeight/100*this.scroll_speed),i=Math.round(this.wrapper.clientHeight+window.innerHeight);this.wrapper.style.setProperty("transition","transform "+n+"ms linear"),this.wrapper.style.setProperty("transform","translateY(-"+i+"px)"),this.wrapper.addEventListener("transitionend",()=>{t()})}createElementContent(e,t){let n=Array.isArray(t)?t:[t],i=document.createElement("div"),s=document.createElement("h1"),r=document.createElement("div");i.className="credit-section",s.textContent=e;for(const e in n){let t=document.createElement("p");t.textContent=n[e],r.append(t)}return i.append(s),i.append(r),i}createElementList(e,t){let n=Array.isArray(t),i=document.createElement("div"),s=document.createElement("h1"),r=document.createElement("dl");i.className="credit-section",s.textContent=e;for(const e in t){if(!n){let t=document.createElement("dt");t.textContent=e,r.append(t)}let i=document.createElement("dd");if(Array.isArray(t[e]))for(const n in t[e]){let s=document.createElement("p");s.textContent=t[e][n],i.append(s)}else i.textContent=t[e];r.append(i)}return i.append(s),i.append(r),i}revert(){return Promise.resolve()}}