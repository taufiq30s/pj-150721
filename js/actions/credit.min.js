class Credit extends Monogatari.Action{static matchObject(e){return void 0!==e.Credit}constructor(e){super(),this.statement=e.Credit,this.fade_interval=1400,this.scroll_speed=1400,this.quote_interval=5e3}apply(){return this.engine.settings().isFinished=!0,this.engine.global("block",!0),this.engine.element().find('[data-component="text-box"]').hide(),this.container=document.createElement("credits-container"),this.wrapper=document.createElement("div"),this.container.className="animated fadeIn",this.wrapper.className="wrapper",this.container.append(this.wrapper),this.engine.element().append(this.container),new Promise(e=>{this.runCredit().then(()=>{this.engine.global("block",!1),this.container.classList.remove("fadeIn"),this.container.classList.add("fadeOut"),this.container.addEventListener("animationend",()=>{this.container.remove(),e({advance:!0})})})})}didApply(){return Promise.resolve({advance:!0})}runCredit(){return"fade"in this.statement&&"scroll"in this.statement&&"quote"in this.statement?new Promise(e=>{this.fadeStart(this.statement.fade).then(()=>{this.scrollStart(this.statement.scroll).then(()=>{this.fadeQuoteStart(this.statement.quote).then(()=>{e()})})})}):"fade"in this.statement?this.fadeStart(this.statement.fade):"scroll"in this.statement?this.scrollStart(this.statement.scroll):"quote"in this.statement?this.fadeQuoteStart(this.statement.fade):Promise.resolve()}fadeQuoteStart(e){return this.container.classList.remove("credit-scroll"),this.container.classList.add("credit-fade"),new Promise(t=>{this.fadeQuote(e.content,e.source,t)})}fadeQuote(e,t,n){this.fadeQuoteContent(e,t).then(()=>{n()})}fadeQuoteContent(e,t){this.wrapper.innerHTML="",this.wrapper.style.removeProperty("transition"),this.wrapper.style.removeProperty("transform");let n=this.createElementQuote(e,t);return n.classList.add("animated","fadeIn"),this.wrapper.append(n),new Promise(e=>{setTimeout(()=>{n.classList.remove("fadeIn"),n.classList.add("fadeOut"),n.addEventListener("animationend",()=>{n.remove(),e()})},this.quote_interval)})}fadeStart(e){return this.container.classList.remove("credit-scroll"),this.container.classList.add("credit-fade"),new Promise(t=>{this.fade(e,0,t)})}fade(e,t,n){if(!(t in e))return void n();const s=e[t];"content"in s?this.fadeContent(s.title,s.content,"class"in s?s.class:"").then(()=>{this.fade(e,t+1,n)}):"list"in s?this.fadeList(s.title,s.list,"class"in s?s.class:"").then(()=>{this.fade(e,t+1,n)}):"quote"in this.statement&&this.fadeContent(s.content,s.source).then(()=>{this.fade(e,t+1,n)})}fadeContent(e,t,n=""){let s=this.createElementContent(e,t,n);return s.classList.add("animated","fadeIn"),this.wrapper.append(s),new Promise(e=>{setTimeout(()=>{s.classList.remove("fadeIn"),s.classList.add("fadeOut"),s.addEventListener("animationend",()=>{s.remove(),e()})},this.fade_interval)})}fadeList(e,t,n=""){let s=this.createElementList(e,!1,t,n);return s.classList.add("animated","fadeIn"),this.wrapper.append(s),new Promise(e=>{setTimeout(()=>{s.classList.remove("fadeIn"),s.classList.add("fadeOut"),s.addEventListener("animationend",()=>{s.remove(),e()})},this.fade_interval)})}scrollStart(e){return this.container.classList.remove("credit-fade"),this.container.classList.add("credit-scroll"),new Promise(t=>{this.scroll(e,t)})}scroll(e,t){for(const t in e){const n=e[t];if("content"in n){let e=this.createElementContent(n.title,n.content,"class"in n?n.class:"");this.wrapper.append(e)}else if("list"in n){let e=this.createElementList(n.title,"subtitle"in n&&n.subtitle,n.list,"class"in n?n.class:"");this.wrapper.append(e)}}let n=Math.round(this.wrapper.clientHeight/100*this.scroll_speed),s=Math.round(this.wrapper.clientHeight+window.innerHeight)+100;this.wrapper.style.setProperty("transition","transform "+n+"ms linear"),this.wrapper.style.setProperty("transform","translateY(-"+s+"px)"),this.wrapper.addEventListener("transitionend",()=>{t()})}createImageElement(e){let t=!1;if(e.match(/^[A-Za-z0-9_-]+$/)&&(t=this.engine.asset("images",e)),t){let e=document.createElement("img"),n=this.engine.setting("AssetsPath");return e.src=n.root+"/"+n.images+"/"+t,e}return!1}createContentElement(e){let t=this.createImageElement(e);if(!1!==t)return t;let n=document.createElement("p");return n.textContent=e,n}createElementContent(e,t,n=""){let s=Array.isArray(t)?t:[t],i=document.createElement("div");i.className="credit-section"+(n?" "+n:"");let a=document.createElement("h1"),r=document.createElement("div");a.textContent=e;for(const e in s){let t=this.createContentElement(s[e]);r.append(t)}return i.append(a),i.append(r),i}createElementQuote(e,t){let n=document.createElement("div");n.className="credit-section";let s=document.createElement("p"),i=document.createElement("p");return s.textContent=e,i.textContent=t,i.id="source",n.append(s),n.append(i),n}createElementList(e,t,n,s=""){let i,a=document.createElement("div"),r=document.createElement("h1");a.className="credit-section"+(s?" "+s:""),r.textContent=e,a.append(r),t&&(i=document.createElement("h3"),i.textContent=t,a.append(i)),Array.isArray(n)&&"string"!=typeof n[0]||(n=[n]);for(const e in n){let t=n[e],s=document.createElement("dl"),i=Array.isArray(t);for(const e in t){if(!i){let t=document.createElement("dt");t.textContent=e,s.append(t)}let n=document.createElement("dd");if(Array.isArray(t[e]))for(const s in t[e]){let i=this.createContentElement(t[e][s]);n.append(i)}else{let s=this.createImageElement(t[e]);s?n.append(s):n.textContent=t[e]}s.append(n)}a.append(s)}return a}revert(){return Promise.resolve()}}