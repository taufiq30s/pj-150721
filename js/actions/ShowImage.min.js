class ShowImage extends Monogatari.Action{static setup(){return monogatari.history("image"),monogatari.state({images:[]}),Promise.resolve()}static reset(){return monogatari.element().find('[data-screen="game"] [data-image]').remove(),monogatari.state({images:[]}),Promise.resolve()}static onLoad(){const{images:t}=monogatari.state(),e=[];for(const a of t){const t=monogatari.prepareAction(a,{cycle:"Application"}),s=t.willApply().then(()=>t.apply().then(()=>t.didApply({updateHistory:!1,updateState:!1})));e.push(s)}return e.length>0?Promise.all(e):Promise.resolve()}static matchString([t,e]){return"show"===t&&"image"===e}constructor([t,e,a,...s]){super(),this.asset=a,this.classes=(" "+s.join(" ")).replace(" at "," ").replace(" with "," ").trim().split(" "),void 0!==monogatari.asset("images",a)?this.image=monogatari.asset("images",a):this.image=a}apply(){const t=document.createElement("div"),e=document.createElement("img"),a=this._statement.match(/at\s(\S*)/);$_(t).addClass("wrapper-image"),$_(e).attribute("src",`${monogatari.setting("AssetsPath").root}/${monogatari.setting("AssetsPath").images}/${this.image}`),$_(t).addClass("animated"),$_(e).data("image",this.asset);for(const e of this.classes)e&&$_(t).addClass(e);if(a instanceof Array){const[t,s]=a;$_(e).data("position",s)}else $_(e).addClass("center"),$_(e).data("position","center");const s=this.classes.indexOf("duration");return s>-1&&$_(t).style("animation-duration",this.classes[s+1]),$_(t).append(e),monogatari.element().find('[data-screen="game"] [data-content="visuals"]').append(t.outerHTML),Promise.resolve()}didApply({updateHistory:t=!0,updateState:e=!0}={}){return!0===t&&monogatari.history("image").push(this._statement),!0===e&&monogatari.state({images:[...monogatari.state("images"),this._statement]}),Promise.resolve({advance:!0})}revert(){return monogatari.element().find(`[data-image="${this.asset}"]`).remove(),Promise.resolve()}didRevert(){return monogatari.history("image").pop(),monogatari.state({images:[...monogatari.state("images").filter(t=>{if("string"==typeof t){const[e,a,s]=t.split(" ");return s!==this.asset}})]}),Promise.resolve({advance:!0,step:!0})}}ShowImage.id="Show::Image",monogatari.registerAction(ShowImage);